<%- include('../includes/head.ejs') %>
    <link rel="stylesheet" href="/css/card.css">
    </head>

    <body>
        <%- include('../includes/navigation.ejs') %>
            <main class="centered">
                <%if(permission){%>
                    <div class="position-fixed " style="right:3%; bottom:60%; width: 40px;">
                        <div class="col" style="padding: 0px; text-align: center; margin: auto; min-height: 70px;">
                            <a href="/admin/edit-project/<%= project._id %>?edit=true" class="btn btn-link btn-edit" style="padding: 0px; color: #6e706d!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                    class="bi bi-pencil-square" viewBox="0 0 16 16">
                                    <path
                                        d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                    <path fill-rule="evenodd"
                                        d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                                </svg></a>
                            <a href="/admin/contribute?projectId=<%= project._id %>" class="btn btn-link btn-edit" style = "padding: 0px; margin-top:30px ; color: #6e706d!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                    class="bi bi-eye" viewBox="0 0 16 16">
                                    <path
                                        d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                    <path
                                        d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                </svg>
                            </a>
                        </div>
                    </div>

                    <%}%>

                        <div class=" row col-12 col-lg-8" style="margin: auto;">
                            <blockquote class="blockquote mt-3">
                                <p class="mb-0" style="font-size: 1.8rem; padding-top:3rem;
                        line-height: 2.5rem; font-weight: 500; font-family: Nunito,Arial,sans-serif; color:#a50064">
                                    <%= project.title %>
                                </p>
                                <footer class="blockquote-footer" style="padding-bottom:3rem;">Có điều kỳ diệu xảy đến
                                    với những người thực sự biết yêu
                                    thương: họ càng cho nhiều, họ càng có nhiều. <cite title="Source Title">– Rainer
                                        Maria
                                        Rilke</cite></footer>
                            </blockquote>
                            <hr>
                            <div class="col-12 col-md-7">
                                <div>

                                    <div class="image">
                                        <img src="/<%= project.imageUrl %>" alt="<%= project.title %>"
                                            style="width:100%">
                                    </div>
                                    <div class="mt-3 description">
                                        <%-project.description %>
                                    </div>
                                    <hr>
                                </div>

                            </div>
                            <div class="col-12 col-md-5">
                                <div class="card mt-3 sticky-top"
                                    style=" top:72px;width: 20rem; border-radius: 0.5rem; max-width: 100%;">
                                    <img class="card-img-top" style="border-radius: 0.5rem;"
                                        src="/<%= project.imageUrl %>" alt="Card image cap">
                                    <div class="card-body">
                                        <p><span style="color:rgb(64, 64, 64); font-weight: bolder;">
                                                <%= project.totalAmountRaised.toLocaleString('vi', {style : 'currency' ,
                                                    currency : 'VND' })%>
                                            </span><span style="color:rgb(115, 115, 115);">/
                                                <%= project.target.toLocaleString('vi', {style : 'currency' , currency
                                                    : 'VND' })%>
                                            </span></p>
                                        <div class="m-1"
                                            style="width:100%; height: 0.2rem; background-color: #b2bdc6d5; border-radius:0.2em;">
                                            <div
                                                style=" width: <%= (project.totalAmountRaised/project.target*100).toString() %>%; height: 0.2rem;  <% if(project.totalAmountRaised/project.target*100 >=100) {%> background-color: #7eb54a ; <%}else{%>background-color: #a50064;<%}%>; border-radius:0.2em;">
                                            </div>
                                        </div>
                                        <div class="row m-1">
                                            <div style="width: 35%">
                                                <p style="font-size: 0.8rem; color: #b2bdc6d5; margin-bottom:0rem;">Lượt
                                                    quyên góp</p>
                                                <p style="color: rgba(82,82,82,1) ;">
                                                    <%=new Intl.NumberFormat().format(project.luotQuyengop) %>
                                                </p>
                                            </div>
                                            <div style="width: 30%; text-align: center;">
                                                <p style="font-size: 0.8rem; color: #b2bdc6d5; margin-bottom:0rem;">Đạt
                                                    được</p>
                                                <p style="color: rgba(82,82,82,1);">
                                                    <%= new
                                                        Intl.NumberFormat().format((project.totalAmountRaised/project.target*100))%>
                                                        %
                                                </p>
                                            </div>
                                        </div>
                                        <form action="/quyengop" method="POST" novalidate>
                                            <div class="form-group">
                                                <label for="contributionAmount">Số tiền</label>
                                                <input type="number" name="contributionAmount" id="contributionAmount"
                                                    class="<%= validationErrors.find(e => e.param === 'contributionAmount') ? ' form-control invalid' : 'form-control' %>"
                                                    placeholder="<%=(1000000).toLocaleString('vi', {style : 'currency' , currency : 'VND' }) %>"
                                                    value=""
                                                    style="color:#a50064; border-color: #a50064; border-radius:0.2em;">
                                                <small class="form-text text-muted" id='targetString'></small>
                                            </div>
                                            <div class="form-group">
                                                <label for="message"> Lời nhắn gửi</label>
                                                <input type="text" name="message" id="message"
                                                    class="<%= validationErrors.find(e => e.param === 'Message') ? ' form-control invalid' : 'form-control' %>"
                                                    style="border-radius:0.2em;" value="" placeholder=" Bình an nhé!">
                                            </div>

                                            <div class="form-check">
                                                <input class="form-check-input selectElement" type="checkbox" value=""
                                                    id="check_hine" /> Quyên góp ẩn danh
                                            </div>
                                            <input type="hidden" name="projId" value="<%= project._id %>">

                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <%if(project.status=='stop'){%>
                                                <div class="btn btn-primary btn-block"
                                                    style=" margin: auto; color: #f8f9fa; background-color:#f5f8f2 !important; border-color: #6e706d!important; color:#6e706d; border-radius:5em;">
                                                    Ngưng nhận tiền
                                                </div>
                                                <%}else if(project.totalAmountRaised/project.target*100>=100) {%>
                                                    <div type="text" class="btn btn-primary btn-block"
                                                        style="color: #f8f9fa; background-color:#f5f8f2 !important; border-color: #6e706d!important; color:#6e706d; border-radius:5em;">
                                                        Đạt Mục tiêu</div>
                                                    <%}else if(project.startDate> new Date()){%>
                                                        <div class="btn btn-primary btn-block"
                                                            style="background-color:#ffe8df !important; color: #fb923c !important; border-color: #fb923c!important;;border-radius:5rem;">
                                                            Coming soon</div>
                                                        <%}else{%>
                                                            <button type="submit" class="btn btn-primary btn-block"
                                                                style="color: #f8f9fa; background-color: #a50064; border-color: #a50064;border-radius:0.2em;">
                                                                Quyên góp</button>
                                                            <%}%>
                                        </form>

                                    </div>
                                    <div class="card-footer">
                                        <%if(project.status=='stop' ){%>
                                            <small class="text-muted">finished</small>
                                            <%}else if(project.startDate> new Date()){%>
                                                <small class="text-muted">coming soon</small>
                                                <%}else if (project.totalAmountRaised>= project.target){%>
                                                    <small class="text-muted">Đạt mục tiêu</small>
                                                    <%} else if(project.startDate <=new Date()){%>
                                                        <small class="text-muted"
                                                            style="background-color:#ffe8df;border-radius:3rem; color: #fb923c !important; padding:0.1rem;">
                                                            còn <%= Math.floor((project.endDate.valueOf() - new
                                                                Date().valueOf())/86400000)%> ngày</small>
                                                        <%}else {%>
                                                            <small class="text-muted">finished</small>
                                                            <%}%>
                                    </div>
                                </div>

                            </div>


                        </div>


            </main>
            <script src="/js/detail.js"></script>
            <%- include('../includes/end.ejs') %>